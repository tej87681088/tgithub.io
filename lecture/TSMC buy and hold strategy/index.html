
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://tejtw.github.io/TQuantLab/lecture/TSMC%20buy%20and%20hold%20strategy/">
      
      
        <link rel="prev" href="../Simple%20Algorithm-TargetPercentPipeAlgo/">
      
      
        <link rel="next" href="../Universe%20Analysis%EF%BC%8Dusing%20get_universe/">
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>TSMC 買進持有策略 - TQuant Lab</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tsmc" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="TQuant Lab" class="md-header__button md-logo" aria-label="TQuant Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            TQuant Lab
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              TSMC 買進持有策略
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_1">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_3" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_3">
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_4">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  TQuant-Lab

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../Data%20collection%20%283%29/" class="md-tabs__link">
          
  
    
  
  Lecture

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="TQuant Lab" class="md-nav__button md-logo" aria-label="TQuant Lab" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    TQuant Lab
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TQuant-Lab
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Lecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Lecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Data%20collection%20%283%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Collection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Install%20TQuant%20Lab%20%283%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    TQuant Lab 安裝教學
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Simple%20Algorithm-TargetPercentPipeAlgo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Target Percent Pipeline Algorithm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    TSMC 買進持有策略
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    TSMC 買進持有策略
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      導入股價資料
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize 函式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handle_data" class="md-nav__link">
    <span class="md-ellipsis">
      Handle_data 函式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handle_data 函式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ziplineapiorder" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.api.order
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.api.order">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ziplinedatacurrent" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.data.current
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.data.current">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze 函式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Run_algorithm 函式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run_algorithm 函式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ziplinerun_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.run_algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.run_algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Universe%20Analysis%EF%BC%8Dusing%20get_universe/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Universe Analysis－using get universe
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../get_universe%E8%AA%AA%E6%98%8E/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    get_universe說明
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      導入股價資料
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initialize" class="md-nav__link">
    <span class="md-ellipsis">
      Initialize 函式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handle_data" class="md-nav__link">
    <span class="md-ellipsis">
      Handle_data 函式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handle_data 函式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ziplineapiorder" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.api.order
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.api.order">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ziplinedatacurrent" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.data.current
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.data.current">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_1" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analyze" class="md-nav__link">
    <span class="md-ellipsis">
      Analyze 函式
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      Run_algorithm 函式
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run_algorithm 函式">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ziplinerun_algorithm" class="md-nav__link">
    <span class="md-ellipsis">
      zipline.run_algorithm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="zipline.run_algorithm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#parameters_2" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="tsmc">TSMC 買進持有策略</h1>
<p>本次範例將以最經典的買進持有策略向您介紹 zipline 回測方法，並且介紹組建 zipline 交易策略最基礎的四大函式 - <code>initialize</code>、<code>handle_data</code>、<code>analyze</code>、<code>run_algorithm</code>。</p>
<h2 id="_1">導入股價資料</h2>
<p>在 zipline 中，我們使用 <code>os</code> 搭配 <code>!zipline ingest</code> 將股價資料導入到本地端。常用寫法為: 
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>!zipline ingest -b tqant 
</code></pre></div>
其中 <code>-b</code> 為 bundle 之涵義，bundle 為股票價量資訊的載體，<code>tquant</code> 則是 bundle 之名稱，可由使用者自定義。在 ingest 之前，需先使用 <code>os</code> 設定環境變數，以方便 zipline 接收使用者所欲抓取之資產標的與年份之要求。一般而言，針對環境變數之寫法如下:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>os.environ[&#39;TEJAPI_BASE&#39;] = &quot;https://api.tej.com.tw&quot; ==&gt; 導航至 tej api 網域。
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>os.environ[&#39;TEJAPI_KEY&#39;] = &quot;your key&quot; ==&gt; 個人 api key 以驗證身分。
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>os.environ[&#39;mdate&#39;] = &quot;20170601 20230702&quot; ==&gt; 欲抓取資料之日期區間，前者為起始日，後者為終止日。
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>os.environ[&#39;ticker&#39;] = &#39;2330 2337&#39; ==&gt; 所欲抓取股票之代碼。
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kn">import</span> <span class="nn">os</span> 
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TEJAPI_BASE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;https://api.tej.com.tw&quot;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;TEJAPI_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;your key&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;mdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;20170601 20230702&quot;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;ticker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;2330 IR0001&#39;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="err">!</span><span class="n">zipline</span> <span class="n">ingest</span> <span class="o">-</span><span class="n">b</span> <span class="n">tquant</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Merging daily equity files:


[2023-08-09 05:09:50.565678] INFO: zipline.data.bundles.core: Ingesting tquant.
</code></pre></div>
<h2 id="initialize">Initialize 函式</h2>
<p><code>initialize</code> 為構建 zipline 交易策略的重要函式，會在回測開始前被呼叫一次，主要任務為設定回測環境，常見用於設定滑價或手續費。分別可以使用:</p>
<ol>
<li>
<p>zipline.api.set_slippage</p>
<p>設定滑價模式，zipline 共提供四種滑價計算方法，詳請請見後續教學-zipline slippage。</p>
</li>
<li>
<p>zipline.api.set_commission</p>
<p>設定手續費模式，zipline 共提供三種手續費計算方法，詳請請見後續教學-zipline commission。</p>
</li>
</ol>
<p>常見的寫法如下:
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>def initialize(context):
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>    set_slippage(slippage.FixedSlippage())
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>    set_commission(commission.PerShare(cost=0.00285))
</code></pre></div>
除此之外，我們可以注意到 initialize 含有一個參數 <strong>context</strong>，<strong>context</strong> 為一個命名空間 (namespace)，可以在儲存各種自定義之變數並且在每次交易日中循環呼叫。舉例來說，我們設置一個變數 (context.day = 0) 來計算交易日天數與一個變數 (context.has_ordered = False) 紀錄是否已經持有台積電股票。
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>def initialize(context):
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>    context.day = 0
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>    context.has_ordered = False
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>    set_slippage(slippage.FixedSlippage())
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>    set_commission(commission.PerShare(cost=0.00285))
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">set_slippage</span><span class="p">,</span> <span class="n">set_commission</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kn">from</span> <span class="nn">zipline.finance</span> <span class="kn">import</span> <span class="n">slippage</span><span class="p">,</span> <span class="n">commission</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    <span class="n">context</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>    <span class="n">context</span><span class="o">.</span><span class="n">has_ordered</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>    <span class="n">set_slippage</span><span class="p">(</span><span class="n">slippage</span><span class="o">.</span><span class="n">FixedSlippage</span><span class="p">())</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>    <span class="n">set_commission</span><span class="p">(</span><span class="n">commission</span><span class="o">.</span><span class="n">PerShare</span><span class="p">(</span><span class="n">cost</span><span class="o">=</span><span class="mf">0.00285</span><span class="p">))</span>
</code></pre></div>
<h2 id="handle_data">Handle_data 函式</h2>
<p><code>handle_data</code> 為構建 zipline 交易策略的重要函式，會在回測開始後每天被呼叫，主要任務為設定交易策略、下單與紀錄交易資訊。</p>
<p>其中 <code>handle_data</code> 含有兩種參數 -- <strong>context</strong> , <strong>data</strong>。<strong>context</strong> 與上述 <code>initialize</code> 介紹功能相同，這裡為了記錄交易天數與否持有台積電股票，我們設定為:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>def handle_data(context, data):
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>    # 每次交易日加 1 天。
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>    context.day += 1 
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>    # 判別是否持有台積電，請注意我們在 initialize 設定 context.has_ordered 為 False。
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>    if not context.has_ordered:
</code></pre></div>
<p>接著我們引入交易下單函式，下單函式共有六個不同種類，請見教材中以 zipline order 開頭之文件，這裡使用最基礎的下單函式:</p>
<h3 id="ziplineapiorder">zipline.api.order</h3>
<p>買進或賣出 n 股的資產標的。</p>
<h4 id="parameters">Parameters:</h4>
<ul>
<li>asset: <em>zipline.assets.Asset</em>
        欲下單之資產，請注意資料型態為 zipline 獨有的 Asset 型態。</li>
<li>amount: <em>int</em>
        欲下單股數。</li>
<li>limit_price: <em>float</em>, optional
        限價。</li>
<li>stop_price: <em>float</em>, optional
        停價。</li>
</ul>
<p>加入下單函式 order(symbol("2330")，其中 symbol("2330") 就是 zipline 中的 Asset 資料型態。之後，我們會將 context.has_ordered 調整成 True，此時下個交易日就不會再度下單，更改完程式如下:
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>def handle_data(context, data):
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    context.day += 1 
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    if not context.has_ordered:
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>        # 下單台積電股票一張 == 1000股
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>        order(symbol(&quot;2330&quot;, 1000)
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>        # 設定 context.has_ordered 為 True 以避免下次交易日下單
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>        context.has_ordered = True
</code></pre></div>
最後為了記錄交易天數、是否持有部位與當日價格，我們使用 <code>record</code> 函式，其功能為記錄每個交易日的資訊並且在最終 <code>run_algorithm</code> 輸出的資料表中，以欄位型式加入所紀錄資訊。其程式編輯方式如下:
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>record( 欄位名稱 = 資訊)
</code></pre></div>
這裡我們紀錄當天交易天數 (context.day)、是否持有部位 (context.has_ordered) 與當天收盤價格 (data.current(symbol("2330"), "close"))，其中上面所提到的 data 就是在 <code>handle_data</code> 中的 <strong>data</strong>，<strong>data</strong> 主要功能為保存每天股價的價量資料並且提供呼叫，於本實例我們欲紀錄當天收盤價，於是用到 <code>data.current()</code> 函式。</p>
<h3 id="ziplinedatacurrent">zipline.data.current</h3>
<p>呼叫股票的當日價量資訊。</p>
<h4 id="parameters_1">Parameters:</h4>
<ul>
<li>assets: <em>zipline.asset.Asset</em>
        所欲呼叫的股票，請注意資料型態為 zipline 獨有的 Asset 型態。</li>
<li>fields: <em>str</em>
        所欲呼叫的價量資訊，提供 'close', 'open', 'high', 'low' 與 'volume'。</li>
</ul>
<p>由於我們希望記錄台積電當日收盤價格，因此程式編輯如下:
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>def handle_data(context, data):
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>    context.day += 1 
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>    if not context.has_ordered:
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>        order(symbol(&quot;2330&quot;, 1000)
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>        context.has_ordered = True
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>    record( # 紀錄用
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>        trade_days = context.day,
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>        has_ordered = context.has_ordered,
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>        TSMC = data.current(symbol(&quot;2330&quot;), &quot;close&quot;)
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>    )
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kn">from</span> <span class="nn">zipline.api</span> <span class="kn">import</span> <span class="n">order</span><span class="p">,</span> <span class="n">record</span><span class="p">,</span> <span class="n">symbol</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">def</span> <span class="nf">handle_data</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>    <span class="n">context</span><span class="o">.</span><span class="n">day</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">context</span><span class="o">.</span><span class="n">has_ordered</span><span class="p">:</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>        <span class="n">order</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>        <span class="n">context</span><span class="o">.</span><span class="n">has_ordered</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="n">record</span><span class="p">(</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="n">trade_days</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">day</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        <span class="n">has_ordered</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">has_ordered</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="n">TSMC</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">current</span><span class="p">(</span><span class="n">symbol</span><span class="p">(</span><span class="s2">&quot;2330&quot;</span><span class="p">),</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="p">)</span>
</code></pre></div>
<h2 id="analyze">Analyze 函式</h2>
<p><code>analyze</code> 主要用於回測後視覺化策略績效與風險，這裡我們以 <code>matplotlib</code> 繪製投組價值表與台積電股價走勢表。其中 <code>analyze</code> 有兩個參數 <strong>context</strong> 與 <strong>perf</strong>，<strong>context</strong> 就與上述相同，<strong>perf</strong> 就是最終 <code>run_algorithm</code> 輸出的資料表 -- <strong>results</strong>。我們可以提取裡面特定欄位來繪製圖表。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">perf</span><span class="p">):</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">perf</span><span class="o">.</span><span class="n">portfolio_value</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;portfolio values&#39;</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>    <span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>    <span class="n">perf</span><span class="p">[</span><span class="s1">&#39;TSMC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;TSMC close&#39;</span><span class="p">)</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<h2 id="run_algorithm">Run_algorithm 函式</h2>
<h3 id="ziplinerun_algorithm">zipline.run_algorithm</h3>
<p>進行策略回測。</p>
<h4 id="parameters_2">Parameters:</h4>
<ul>
<li>start: <em>pd.Timestamp</em> or <em>datetime</em>
        回測起始日期。</li>
<li>end: <em>pd.Timestamp</em> or <em>datetime</em>
        回測結束日期。</li>
<li>initialize: <em>callable</em>
        呼叫 initialize 函式以用於回測。</li>
<li>capital_base: <em>int</em>
        初始資金額度。</li>
<li>handle_data: <em>callable</em>, optional
        呼叫 handle_data 函式以用於回測。</li>
<li>before_trading_start: <em>callable</em>, optional
        呼叫 before_trading_start 函式以用於回測。</li>
<li>analyze: <em>callable</em>, optional
        呼叫 analyze 函式以用於回測。</li>
<li>data_frequency: <em>{"daily", "minute"}</em>, optional
        設置交易頻率。</li>
<li>bundle: <em>str</em>, optional
        設置回測用的 bundle。</li>
<li>trading_calendar: <em>TradingCalendar</em>, optional
        設置交易日曆。</li>
<li>benchmark_returns: <em>pd.Series</em>, optional
        設置指標報酬率。</li>
<li>treasury_returns: <em>pd.Series</em>, optional
        設置無風險利率。</li>
</ul>
<h4 id="returns">Returns:</h4>
<p>Perf: <em>pd.DataFrame</em>, 內建欄位有:</p>
<ul>
<li>benchmark_return：
    當日的benchmark報酬率，若是由<code>set_benchmark()</code>設定，則計算方式為(當日benchmark收盤價 / 前一日benchmark收盤價) - 1。</li>
<li>benchmark_period_return：
    累積的benchmark日報酬率。計算方式：np.nancumprod(1 + <code>benchmark_return</code> Series) - 1。</li>
<li>treasury_return：
    當日的treasury報酬率，直接由TEJ API提供。</li>
<li>treasury_period_return：
    累積的treasury日報酬率。計算方式：np.nancumprod(1 + <code>treasury_return</code> Series) - 1。</li>
<li>
<p>benchmark_volatility：
    benchmark日報酬率的年化波動率，至少需有兩期的報酬率才進行計算。計算方式：(<code>benchmark_return</code> Series).expanding(2).std(ddof=1) * np.sqrt(252)</p>
</li>
<li>
<p>orders：顯示下單紀錄
    每一筆下單用一個字典的方式呈現，其中：</p>
</li>
<li>id：虛擬單號。</li>
<li>dt：下單時間。</li>
<li>reason：None, Hold, or Reject（目前不適用）</li>
<li>created：建立時間。</li>
<li>amount：<ul>
<li>下單股數。</li>
<li>若&gt;0表示買進或回補，&lt;0表示賣出或放空。</li>
<li>若有發股票股利或股票分割的情形，除權日當天會更新之前未成交訂單的amount（new_amount = old_amount / ratio，其中ratio = 1/僅除權調整係數）。</li>
</ul>
</li>
<li>
<p>filled：成交股數。</p>
<ul>
<li>註：Order execution - 當演算法在某一天下單時，該訂單會在下一個交易日成交，以避免lookahead bias。   </li>
</ul>
</li>
<li>
<p>commission：該筆交易傭金。</p>
</li>
<li>stop：停損價，若有發股票股利或股票分割的情形，除權日當天會更新之前未成交訂單的stop price（new_stop = old_stop * ratio，其中ratio = 1/僅除權調整係數）。</li>
<li>limit：限價價，若有發股票股利或股票分割的情形，除權日當天會更新之前未成交訂單的limit price（new_limit = old_limit * ratio，其中ratio = 1/僅除權調整係數）。</li>
<li>stop_reached：<ul>
<li>對於buy stop order，若現價&gt;=stop price，則顯示True否則False。</li>
<li>對於sell stop order，若現價&lt;=stop price，則顯示True否則False。</li>
</ul>
</li>
<li>limit_reached：<ul>
<li>對於buy limit order，若現價&lt;=limit price，則顯示True否則False。</li>
<li>對於sell limit order，若現價&gt;=limit price，則顯示True否則False。</li>
</ul>
</li>
<li>sid（asset）：下單的標的。</li>
<li>
<p>status：若=0表示OPEN（未完全成交），=1表示FILLED（完全成交），=2表示CANCEL（已取消）。</p>
</li>
<li>
<p>transactions：顯示交易紀錄</p>
</li>
<li>amount：下單股數。</li>
<li>dt ： 交易時間。</li>
<li>price：成交價（為調整前收盤價，不調整股息、分割、股票股利）。</li>
<li>order_id：單號，可與orders中的id比對。</li>
<li>sid（asset）：下單的標的。</li>
<li>
<p>commission：一律為None。傭金資料已經在'orders'底下。</p>
</li>
<li>
<p>positions：顯示持有部位</p>
</li>
<li>sid（asset）：下單的標的。</li>
<li>amount：該標的總持有股數。除權日當天amount會進行調整（old_amount / ratio = new_amount，其中ratio = 1/僅除權調整係數）。</li>
<li>last_sale_price：標的最近一筆的收盤價。</li>
<li>cost_basis：每股平均成本（含commissions）。<ul>
<li>計算方法為：sum(成交價 * (1+commission) * 股數) / 總股數</li>
<li>除權日當天cost_basis會進行調整（old_cost_basis * ratio = new_cost_basis，其中ratio = 1/僅除權調整係數）。</li>
<li>對於買進或回補來說，commissions會造成cost_basis增加；對於賣出或放空來說，commissions會造成cost_basis減少。</li>
</ul>
</li>
<li>longs_count：</li>
<li>當日帳上有幾檔長部位股票。可與<code>positions</code>比較。</li>
<li>shorts_count：</li>
<li>當日帳上有幾檔短部位股票。可與<code>positions</code>比較。</li>
<li>long_exposure（long_value）：</li>
<li>當日帳上長部位的市值。</li>
<li>可與<code>positions</code>比較。</li>
<li>當投資標的為股票時<code>long_exposure</code>和<code>long_value</code>兩欄位數值一致。</li>
<li>計算方式為sum(持有股數 * 收盤價) = sum(amount * last_sale_price)，where amount &gt; 0。</li>
<li>short_exposure（short_value）：</li>
<li>當日帳上短部位的市值。</li>
<li>可與<code>positions</code>比較。</li>
<li>當投資標的為股票時<code>short_exposure</code>和<code>short_value</code>兩欄位數值一致。</li>
<li>計算方式為sum(持有股數 * 收盤價) = sum(amount * last_sale_price)，where amount &lt; 0。</li>
<li>short_exposure必然 &lt;= 0。</li>
<li>ending_exposure（ending_value）：</li>
<li>當日結束時帳上部位的淨市值。</li>
<li>計算方式：<code>long_exposure</code> + <code>short_exposure</code></li>
<li>starting_exposure（starting_value）：</li>
<li>當日開始時帳上部位的淨市值。</li>
<li>為前一日的<code>ending_exposure</code>。</li>
<li>gross_leverage（leverage）：</li>
<li>Gross leverage is the sum of long and short leverage exposure per share divided by net asset value（portfolio_value）。</li>
<li>計算方式：（<code>long_exposure</code> - <code>short_exposure</code>）／<code>portfolio_value</code></li>
<li>net_leverage：</li>
<li>Net leverage is the net leverage exposure per share divided by net asset value（portfolio_value）。</li>
<li>計算方式：（<code>long_exposure</code> + <code>short_exposure</code>）／<code>portfolio_value</code></li>
<li>capital_used：</li>
<li>當天的cash flow。&gt;0表示流入，&lt;0表示流出。</li>
<li>計算方式：<ul>
<li>-1 * sum(<code>transaction.price</code> * <code>transaction.amount</code>) - sum(<code>order.commission</code>) + sum(earn_dividends) + sum(leftover_cash)</li>
</ul>
</li>
<li>
<p>註：    </p>
<ol>
<li>earn_dividends：會於pay_date當天配發。</li>
<li>leftover_cash：分割、股票股利等原因導致股數變動時，若有&lt;1股(fractional_share_count)無法分配的情況時則返回現金。</li>
<li>leftover_cash範例：</li>
<li>若現在持有100股（amount），ratio=3。</li>
<li>新的amount理論上是100/3=33.333，然而不滿一股的部分需轉換成現金 (return cash)。</li>
<li>所以新的amount會是33，剩餘的0.333股（33.333-33）就是fractional_share_count。</li>
<li>由於ratio=3代表該公司股數有發生變動，所以每股平均成本 (cost basis)需調整=原cost basis * 原amount / 新amount 後四捨五入到小數第二位。</li>
<li>所以退回現金(return cash)=(fractional_share_count) * (新cost basis) 再四捨五入到小數第二位</li>
</ol>
</li>
<li>
<p>ending_cash：</p>
</li>
<li>當日結束時帳上持有現金。</li>
<li>計算方式：<code>starting_cash</code>+<code>capital_used</code></li>
<li>starting_cash：</li>
<li>當日開始時帳上持有現金。</li>
<li>為前一日的<code>ending_cash</code>+sum(earn_dividends)，若無前一日則為<code>capital_base</code>。</li>
<li>pnl：</li>
<li>當日投資組合損益。</li>
<li>計算方式：(<code>ending_exposure</code> + <code>ending_cash</code>) - (<code>starting_exposure</code> + <code>starting_cash</code>)。</li>
<li>returns：</li>
<li>當日報酬率。</li>
<li>計算方式：(當日<code>portfolio_value</code>) / (前一日<code>portfolio_value</code>) - 1。</li>
<li>存在尾差。</li>
<li>portfolio_value：</li>
<li>即net asset value，當日投資組合總價值。</li>
<li>計算方式：(<code>ending_exposure</code> + <code>ending_cash</code>)</li>
<li>algorithm_period_return：</li>
<li>投資組合累積日報酬率。</li>
<li>計算方式：( 1 + 前一日的<code>algorithm_period_return</code>) * ( 1 + 當日<code>returns</code>) - 1。</li>
<li>存在尾差。</li>
<li>algo_volatility：</li>
<li>投資組合日報酬率的年化波動率，至少需有兩期的報酬率才進行計算。</li>
<li>利用empyrical套件計算：
    <br> empyrical.annual_volatility(<code>returns</code>Series, period='daily', alpha=2.0, annualization=None)。</li>
<li>具體來說，empyrical套件的計算方式為：<code>returns</code>Series.std(ddof=1) * (252 ** (1 / 2))，std為樣本標準差。</li>
<li>用完整<code>returns</code>資料，則會回傳最後一日algo_volatility，若扣掉最後一日<code>returns</code>，則回傳倒數第二日，以此類推。  </li>
<li>excess_return：</li>
<li>投資組合累積超額日報酬（相對於<code>benchmark_period_return</code>）。</li>
<li>計算方式為：(<code>algorithm_period_return</code> - <code>benchmark_period_return</code>)。</li>
<li>max_drawdown：</li>
<li>投資組合累積報酬率從過去的峰值下跌的最大跌幅百分比。</li>
<li>利用empyrical套件計算：empyrical.max_drawdown(<code>returns</code> Series)。</li>
<li>具體來說，empyrical套件的計算方式為：<ul>
<li>cumulative_returns：先計算過去每一日的累積報酬。</li>
<li>previous_peaks：計算過去累積報酬率的最大值。</li>
<li>daily_drawdown：計算每日回撤 = (cumulative_returns - previous_peaks) / previous_peaks</li>
<li>max_drawdown：過去每一日的daily_drawdown取極小值。</li>
</ul>
</li>
<li>sharpe：</li>
<li>年化夏普比率，衡量每承擔1單位風險，可以獲取多少的報酬。</li>
<li>利用empyrical套件計算：empyrical.sharpe_ratio(<code>returns</code> Series, risk_free=0)。</li>
<li>具體來說，empyrical套件的計算方式為：
    <br>np.mean(<code>returns</code> Series) / np.std(<code>returns</code> Series,ddof=1) * np.sqrt(252)</li>
<li>sortino：   </li>
<li>年化索提諾比率，衡量承擔單位下方風險，可以獲取多少的報酬。</li>
<li>利用empyrical套件計算：empyrical.sortino_ratio(<code>returns</code> Series, required_return=0)。</li>
<li>具體來說，empyrical套件的計算方式為：<ul>
<li>計算downside_risk：np.sqrt(np.nanmean(np.square(downside_return))) * np.sqrt(252)，其中downside_return將<code>returns</code> Series中&gt;0的數值替換成0。</li>
<li>計算mean_return：np.nanmean(<code>returns</code> Series)</li>
<li>計算sortino_ratio =  mean_return / downside_risk * 252。</li>
</ul>
</li>
<li>
<p>存在尾差。</p>
</li>
<li>
<p>alpha：</p>
</li>
<li>年化alpha，衡量投資組合創造超額報酬的能力。</li>
<li>利用empyrical套件計算：empyrical.alpha_beta_aligned(returns=<code>returns</code>Series, factor_returns=<code>benchmark_return</code> Series,risk_free=0.0)</li>
<li>具體來說，empyrical套件的計算方式為：<ul>
<li>計算alpha_series：<code>returns</code> Series - (當日<code>beta</code> * <code>benchmark_return</code> Series)</li>
<li>計算平均alpha：nanmean(alpha_series)</li>
<li>計算年化alpha：(平均alpha + 1) ^ 252 -1  </li>
</ul>
</li>
<li>beta：    </li>
<li>衡量投資組合相對於整體市場的波動性。</li>
<li>利用empyrical套件計算：empyrical.alpha_beta_aligned(returns=<code>returns</code>Series, factor_returns=<code>benchmark_return</code> Series,risk_free=0.0)</li>
<li>具體來說，empyrical套件的計算方式為：
    <br>Cov(<code>benchmark_return</code> Series, <code>returns</code> Series) / Var(<code>benchmark_return</code> Series)</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kn">from</span> <span class="nn">zipline</span> <span class="kn">import</span> <span class="n">run_algorithm</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">start_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2018-12-30&#39;</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="n">end_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2023-05-26&#39;</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="s1">&#39;utc&#39;</span><span class="p">)</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="n">results</span> <span class="o">=</span> <span class="n">run_algorithm</span><span class="p">(</span><span class="n">start</span><span class="o">=</span> <span class="n">start_date</span><span class="p">,</span>  
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>                       <span class="n">end</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>                       <span class="n">initialize</span><span class="o">=</span><span class="n">initialize</span><span class="p">,</span>                       
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>                       <span class="n">capital_base</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>                       
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>                       <span class="n">analyze</span><span class="o">=</span><span class="n">analyze</span><span class="p">,</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>                       <span class="n">handle_data</span><span class="o">=</span><span class="n">handle_data</span><span class="p">,</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>                       <span class="n">data_frequency</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>                       <span class="n">bundle</span><span class="o">=</span><span class="s1">&#39;tquant&#39;</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>                       <span class="p">)</span>
</code></pre></div>
<p><img alt="png" src="output_10_0.png" /></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">results</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>period_open</th>
      <th>period_close</th>
      <th>short_value</th>
      <th>long_exposure</th>
      <th>benchmark_return</th>
      <th>treasury_return</th>
      <th>pnl</th>
      <th>short_exposure</th>
      <th>capital_used</th>
      <th>returns</th>
      <th>...</th>
      <th>treasury_period_return</th>
      <th>algorithm_period_return</th>
      <th>alpha</th>
      <th>beta</th>
      <th>sharpe</th>
      <th>sortino</th>
      <th>max_drawdown</th>
      <th>max_leverage</th>
      <th>trading_days</th>
      <th>period_label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-01-02 13:30:00+08:00</th>
      <td>2019-01-02 09:01:00+08:00</td>
      <td>2019-01-02 13:30:00+08:00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1</td>
      <td>2019-01</td>
    </tr>
    <tr>
      <th>2019-01-03 13:30:00+08:00</th>
      <td>2019-01-03 09:01:00+08:00</td>
      <td>2019-01-03 13:30:00+08:00</td>
      <td>0.0</td>
      <td>215500.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-2.85</td>
      <td>0.0</td>
      <td>-215502.85</td>
      <td>-0.000003</td>
      <td>...</td>
      <td>0.0</td>
      <td>-0.000003</td>
      <td>None</td>
      <td>None</td>
      <td>-11.224972</td>
      <td>-11.224972</td>
      <td>-0.000003</td>
      <td>0.215501</td>
      <td>2</td>
      <td>2019-01</td>
    </tr>
    <tr>
      <th>2019-01-04 13:30:00+08:00</th>
      <td>2019-01-04 09:01:00+08:00</td>
      <td>2019-01-04 13:30:00+08:00</td>
      <td>0.0</td>
      <td>208000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-7500.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>-0.007500</td>
      <td>...</td>
      <td>0.0</td>
      <td>-0.007503</td>
      <td>None</td>
      <td>None</td>
      <td>-9.170376</td>
      <td>-9.168633</td>
      <td>-0.007503</td>
      <td>0.215501</td>
      <td>3</td>
      <td>2019-01</td>
    </tr>
    <tr>
      <th>2019-01-07 13:30:00+08:00</th>
      <td>2019-01-07 09:01:00+08:00</td>
      <td>2019-01-07 13:30:00+08:00</td>
      <td>0.0</td>
      <td>213000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>5000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.005038</td>
      <td>...</td>
      <td>0.0</td>
      <td>-0.002503</td>
      <td>None</td>
      <td>None</td>
      <td>-1.893153</td>
      <td>-2.608781</td>
      <td>-0.007503</td>
      <td>0.215501</td>
      <td>4</td>
      <td>2019-01</td>
    </tr>
    <tr>
      <th>2019-01-08 13:30:00+08:00</th>
      <td>2019-01-08 09:01:00+08:00</td>
      <td>2019-01-08 13:30:00+08:00</td>
      <td>0.0</td>
      <td>211000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-2000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>-0.002005</td>
      <td>...</td>
      <td>0.0</td>
      <td>-0.004503</td>
      <td>None</td>
      <td>None</td>
      <td>-3.141155</td>
      <td>-4.087705</td>
      <td>-0.007503</td>
      <td>0.215501</td>
      <td>5</td>
      <td>2019-01</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2023-05-22 13:30:00+08:00</th>
      <td>2023-05-22 09:01:00+08:00</td>
      <td>2023-05-22 13:30:00+08:00</td>
      <td>0.0</td>
      <td>531000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-1000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>-0.000734</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.362247</td>
      <td>None</td>
      <td>None</td>
      <td>0.816172</td>
      <td>1.250657</td>
      <td>-0.202433</td>
      <td>0.455182</td>
      <td>1063</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>2023-05-23 13:30:00+08:00</th>
      <td>2023-05-23 09:01:00+08:00</td>
      <td>2023-05-23 13:30:00+08:00</td>
      <td>0.0</td>
      <td>530000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-1000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>-0.000734</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.361247</td>
      <td>None</td>
      <td>None</td>
      <td>0.813954</td>
      <td>1.247253</td>
      <td>-0.202433</td>
      <td>0.455182</td>
      <td>1064</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>2023-05-24 13:30:00+08:00</th>
      <td>2023-05-24 09:01:00+08:00</td>
      <td>2023-05-24 13:30:00+08:00</td>
      <td>0.0</td>
      <td>525000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>-5000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>-0.003673</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.356247</td>
      <td>None</td>
      <td>None</td>
      <td>0.804283</td>
      <td>1.232180</td>
      <td>-0.202433</td>
      <td>0.455182</td>
      <td>1065</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>2023-05-25 13:30:00+08:00</th>
      <td>2023-05-25 09:01:00+08:00</td>
      <td>2023-05-25 13:30:00+08:00</td>
      <td>0.0</td>
      <td>543000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>18000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.013272</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.374247</td>
      <td>None</td>
      <td>None</td>
      <td>0.835019</td>
      <td>1.282067</td>
      <td>-0.202433</td>
      <td>0.455182</td>
      <td>1066</td>
      <td>2023-05</td>
    </tr>
    <tr>
      <th>2023-05-26 13:30:00+08:00</th>
      <td>2023-05-26 09:01:00+08:00</td>
      <td>2023-05-26 13:30:00+08:00</td>
      <td>0.0</td>
      <td>566000.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>23000.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.016736</td>
      <td>...</td>
      <td>0.0</td>
      <td>0.397247</td>
      <td>None</td>
      <td>None</td>
      <td>0.873009</td>
      <td>1.345075</td>
      <td>-0.202433</td>
      <td>0.455182</td>
      <td>1067</td>
      <td>2023-05</td>
    </tr>
  </tbody>
</table>
<p>1067 rows × 42 columns</p>
</div>

<p>我們可以發現之前使用 <code>order</code> 紀錄的 trade_days, has_ordered 與 TSMC 確實以欄位型式記錄在 <strong>results</strong> 表中。 </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">results</span><span class="p">[[</span><span class="s1">&#39;trade_days&#39;</span><span class="p">,</span><span class="s1">&#39;has_ordered&#39;</span><span class="p">,</span><span class="s1">&#39;TSMC&#39;</span><span class="p">]]</span>
</code></pre></div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>trade_days</th>
      <th>has_ordered</th>
      <th>TSMC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2019-01-02 13:30:00+08:00</th>
      <td>1</td>
      <td>True</td>
      <td>219.5</td>
    </tr>
    <tr>
      <th>2019-01-03 13:30:00+08:00</th>
      <td>2</td>
      <td>True</td>
      <td>215.5</td>
    </tr>
    <tr>
      <th>2019-01-04 13:30:00+08:00</th>
      <td>3</td>
      <td>True</td>
      <td>208.0</td>
    </tr>
    <tr>
      <th>2019-01-07 13:30:00+08:00</th>
      <td>4</td>
      <td>True</td>
      <td>213.0</td>
    </tr>
    <tr>
      <th>2019-01-08 13:30:00+08:00</th>
      <td>5</td>
      <td>True</td>
      <td>211.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2023-05-22 13:30:00+08:00</th>
      <td>1063</td>
      <td>True</td>
      <td>531.0</td>
    </tr>
    <tr>
      <th>2023-05-23 13:30:00+08:00</th>
      <td>1064</td>
      <td>True</td>
      <td>530.0</td>
    </tr>
    <tr>
      <th>2023-05-24 13:30:00+08:00</th>
      <td>1065</td>
      <td>True</td>
      <td>525.0</td>
    </tr>
    <tr>
      <th>2023-05-25 13:30:00+08:00</th>
      <td>1066</td>
      <td>True</td>
      <td>543.0</td>
    </tr>
    <tr>
      <th>2023-05-26 13:30:00+08:00</th>
      <td>1067</td>
      <td>True</td>
      <td>566.0</td>
    </tr>
  </tbody>
</table>
<p>1067 rows × 3 columns</p>
</div>

<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../Simple%20Algorithm-TargetPercentPipeAlgo/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Target Percent Pipeline Algorithm">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Target Percent Pipeline Algorithm
              </div>
            </div>
          </a>
        
        
          
          <a href="../Universe%20Analysis%EF%BC%8Dusing%20get_universe/" class="md-footer__link md-footer__link--next" aria-label="Next: Universe Analysis－using get universe">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Universe Analysis－using get universe
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; TEJ/All Rights Reserved.
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/tejtw" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/showcase/%E5%8F%B0%E7%81%A3%E7%B6%93%E6%BF%9F%E6%96%B0%E5%A0%B1-tej-?originalSubdomain=tw" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3M447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/your-twitter-handle" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            




  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" >
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "navigation.instant", "navigation.instant.progress", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "content.action.edit", "content.action.view", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>